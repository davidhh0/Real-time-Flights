<!DOCTYPE html>
<html>

<head>
    <title></title>
    <meta charset="utf-8" />
    <script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=GetMap' async defer></script>
    <script type='text/javascript'>
        function GetMap() {
            var map = new Microsoft.Maps.Map('#myMap', {
                credentials: 'As4jqrkoyeQcRTOqIBiQgui2O7xH5QO_Xahh37r63HnpJLdPRNq3kqmYwmYnbZJQ'
            });
            var lon = 34.853195;
            var lat = 32.321457;
            var loc = new Microsoft.Maps.Location(lat, lon);

            p1 = {
                x: lat,
                y: lon
            };
            p2 = {
                x: 35.095192,
                y: 33.203430
            };
            let angle = Math.atan2(p2.y - p1.y, p2.x - p1.x) * (180 / Math.PI);
            
            createRotatedImagePushpin(map.getCenter(), 'https://i.ibb.co/FWyC5Yz/airplane-mode-1.png', angle, function (pin) {
                map.entities.push(pin);
            });
            //listener();
        }

        function createRotatedImagePushpin(location, url, rotationAngle, callback) {
            var img = new Image();
            img.onload = function () {
                var c = document.createElement('canvas');

                var rotationAngleRads = rotationAngle * Math.PI / 180;

                var context = c.getContext('2d');

                //Move to the center of the canvas.
                context.translate(c.width / 2, c.height / 2);

                //Rotate the canvas to the specified angle in degrees.
                context.rotate(rotationAngleRads);

                //Draw the image, since the context is rotated, the image will be rotated also.
                context.drawImage(img, -img.width / 2, -img.height / 2);

                var pin = new Microsoft.Maps.Pushpin(location, {
                    //Generate a base64 image URL from the canvas.
                    icon: c.toDataURL(),
                    anchor: new Microsoft.Maps.Point(c.width / 2, c.height / 2) //Anchor to center of image.
                });

                if (callback) {
                    callback(pin);
                }
            };

            img.crossOrigin = 'anonymous';
            img.src = url;
        }

        function listener() {
            for (let i = 1; i < 10; i++) {
                setTimeout(function timer() {
                    console.log("hello world");
                }, i * 3000);
            }
        }

    </script>
</head>

<body>
    <div id="myMap" style="max-width:100%;height:600px;
    border: 3px solid black;"></div>
</body>

</html>